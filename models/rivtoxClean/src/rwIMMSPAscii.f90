!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE ReadSolutionHeader_IMMSPAscii(IFU, ID,NFr,NDim,NN,StartT,EndT)
!------------------------------------------------------------------------------C
INTEGER*4 IFU
CHARACTER*(*) ID
INTEGER*4 NFr,NDim,NN
REAL*8 StartT,EndT

INTENT(IN) IFU
INTENT(OUT) ID,NFr,NDim,NN,StartT,EndT
!------------------------------------------------------------------------------C
 read(IFU,*) ID,NFr,NDim,NN,StartT,EndT
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE ReadSolutionHeaderTimes_IMMSPAscii(IFU, ID,NFr,NDim,NN,Times)
!------------------------------------------------------------------------------C
INTEGER*4 IFU
CHARACTER*(*) ID
INTEGER*4 NFr,NDim,NN
REAL*8 Times(*)

INTENT(IN) IFU
INTENT(OUT) ID,NFr,NDim,NN,Times
!------------------------------------------------------------------------------C
REAL*8 StartT,EndT
!------------------------------------------------------------------------------C
 !--Read solution file header--
 read(IFU,*) ID,NFr,NDim,NN,StartT,EndT
 !----------

 !--Calculate the actual number of data sets in the solution file,--
 !--read all frame times,--
 !--and position the file at the end of file header.--
 NFr=0
 do while (.true.)
   read(IFU,*,end=1) Times(NFr+1)
   NFr=NFr+1
 enddo
 1 CONTINUE
 !----------

 rewind(IFU)
 read(IFU,*)
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\


!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE ReadSolutionFrame_IMMSPAscii(IFU,NDim,NN, frTime,v1,v2)
!------------------------------------------------------------------------------C
INTEGER*4 IFU
INTEGER*4 NDim,NN
REAL*8 frTime
REAL*8 v1(NN),v2(NN)

INTENT(IN) IFU,NDim,NN
INTENT(OUT) frTime,v1,v2
!------------------------------------------------------------------------------C
 if (NDim==1) then
   read(IFU,*) frTime, (v1(i), i=1,NN)
   do i=1,NN
     if (v1(i)==-99999) v1(i)=0.d0 !--Set water surface at SMS dry node to zero
   enddo
 else
   read(IFU,*) frTime, (v1(i),v2(i), i=1,NN)
 endif
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE ReadSolutionFrameR4_IMMSPAscii(IFU,NDim,NN, frTime,v1,v2)
!------------------------------------------------------------------------------C
INTEGER*4 IFU
INTEGER*4 NDim,NN
REAL*4 frTime
REAL*4 v1(NN),v2(NN)

INTENT(IN) IFU,NDim,NN
INTENT(OUT) frTime,v1,v2
!------------------------------------------------------------------------------C
 if (NDim==1) then
   read(IFU,*) frTime, (v1(i), i=1,NN)
   do i=1,NN
     if (v1(i)==-99999) v1(i)=0.0 !--Set water surface at SMS dry node to zero
   enddo
 else
   read(IFU,*) frTime, (v1(i),v2(i), i=1,NN)
 endif
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\


!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE SkipSolutionFrame_IMMSPAscii(IFU)
!------------------------------------------------------------------------------C
INTEGER*4,INTENT(IN) :: IFU
!------------------------------------------------------------------------------C
 read(IFU,*)
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\




!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE WriteSolutionHeader_IMMSPAscii(IFU,ID,NFr,NDim,NN,Times)
!------------------------------------------------------------------------------C
INTEGER*4 IFU
CHARACTER*(*) ID
INTEGER*4 NFr,NDim,NN
REAL*8 Times(*)

INTENT(IN) IFU,ID,NFr,NDim,NN,Times
!------------------------------------------------------------------------------C
INTEGER*4 ln
!------------------------------------------------------------------------------C
 write(IFU,'(A,X,I0,X,I0,X,I0,2(X,1PG17.10))') trim(ID),NFr,NDim,NN,Times(1),Times(NFr)
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\


!//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
SUBROUTINE WriteSolutionFrame_IMMSPAscii(IFU,NDim,NN,frTime,v1,v2)
!------------------------------------------------------------------------------C
INTEGER*4 IFU
INTEGER*4 NDim,NN
REAL*8 frTime
REAL*8 v1(NN),v2(NN)

INTENT(IN) IFU,frTime,NDim,NN,v1,v2
CHARACTER*100 fmt
!------------------------------------------------------------------------------C
 if (NDim==1) then
   write(fmt,'(A,I0,A)') '(1PG17.10,',NN,'(X,1PG16.9))'
   write(IFU,fmt) frTime, (v1(i), i=1,NN)
!   write(IFU,1111) frTime, (v1(i), i=1,NN)
 else
   write(fmt,'(A,I0,A)') '(1PG17.10,',2*NN,'(X,1PG16.9))'
   write(IFU,fmt) frTime, (v1(i),v2(i), i=1,NN)
!   write(IFU,1112) frTime, (v1(i),v2(i), i=1,NN)
 endif
!------------------------------------------------------------------------------C
!1111 FORMAT(1PG17.10,<NN>(X,1PG16.9))
!1112 FORMAT(1PG17.10,<2*NN>(X,1PG16.9))
!------------------------------------------------------------------------------C
END
!\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
